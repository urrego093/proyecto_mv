(dp1
S'output'
p2
S'<class \'psycopg2.IntegrityError\'> insert or update on table "auth_membership" violates foreign key constraint "auth_membership_group_id_fkey"\nDETAIL:  Key (group_id)=(2) is not present in table "auth_group".\n'
p3
sS'layer'
p4
S'/home/camilo/Escritorio/nuevo_nuevo_repo_git/proyecto_mv/applications/datos/controllers/academia.py'
p5
sS'code'
p6
S'# -*- coding: utf-8 -*-\n# intente algo como\n@auth.requires_login()\n@auth.requires_membership(\'Administrador\')\ndef register_course():\n    form = SQLFORM(db1.course).process()\n    if form.accepted:\n        session.flash = T("Course Create!")\n        redirect(URL(\'default\',\'index\'))\n    return locals()\n\n@auth.requires_login()\ndef create_hostvars_yml(idmachine, systemOpe):\n    datos = dict()\n    if systemOpe == "Ubuntu":\n        datos = dict(ansible_become_pass="reverse", ansible_user="ubuntu")\n        #datos = dict(ansible_become_pass="osboxes.org", ansible_user="osboxes")\n    elif systemOpe == "CentOS":\n        datos = dict(ansible_become_pass="Centosbase123", ansible_user="root")                \n        #datos = dict(ansible_become_pass="osboxes.org", ansible_user="root")\n    elif systemOpe == "Fedora":\n        datos = dict(ansible_become_pass="Centosbase123", ansible_user="root")\n        #datos = dict(ansible_become_pass="osboxes.org", ansible_user="root")\n\n        \n    #datos = dict (ansible_become_pass="reverse", ansible_user="root")\n    \n    ruta_basica = os.path.join(request.folder, \'private/Ansible/host_vars/\')\n    file_path = ruta_basica + idmachine\n    escribir_host_yml(file_path,datos)\n        \n@auth.requires_login()\n@auth.requires_membership(\'Administrador\')\ndef register_machine():\n    form = SQLFORM(db1.machine).process()\n    if form.accepted:\n        \n        ip = str(form.vars.ip_machine)\n        sistema_operativo = str(form.vars.operative_system)\n        maquina_id = form.vars.id\n        \n        create_hostvars_yml(ip, sistema_operativo)\n        session.flash = T(" Machine Created!")\n\n        \'\'\'\n            Al crear una maquina en el sistema, de manera autom\xc3\xa1tica se instala la llave local en la maquina\n            para conectar por ssh sin contrase\xc3\xb1a y se instala el paqeuet vnc\n        \'\'\'\n        variables_extra = dict(IP = ip, OS = sistema_operativo)\n        \n        redirect(URL(\'maquinas\', \'ejecutar\', vars= dict(ids=maquina_id, opcion=\'first_time\', variables_extra=variables_extra))) \n\n        #redirect(URL(\'default\',\'index\'))\n    return locals()\n\n@auth.requires_membership(\'Administrador\')\ndef register_group():\n    form = SQLFORM(db1.course_group).process()\n    if form.accepted:\n        session.flash = T("Group Create!")\n        redirect(URL(\'default\',\'index\'))\n    return locals()\n\ndef del_copy(lista1):\n    if lista1==[]:\n        return lista1\n    else:\n        lista2 = []\n        for key in lista1:\n            if key not in lista2:\n                lista2.append(key)\n        return lista2\n\n@auth.requires_login()\ndef r_est():\n    semes = request.args(0)\n    course = db1.course(request.args(2, cast=int))\n    machine = db1.machine(request.args(1, cast=int) or redirect(URL(\'default\',\'index\')))\n    num_group = request.args(3) or redirect(URL(\'default\',\'index\'))\n    port_m = db1(db1.port_machine.ip_machine==machine.id).select()\n    list_port_usados = []\n    list_all_port = []\n\n    for row_mac in port_m:\n        list_all_port.append(row_mac.id)\n        for r_usados in db1((db1.student_x_machine.ip_machine==row_mac.id)).select():\n            if r_usados.semester==semes:\n                list_port_usados.append(r_usados.ip_machine)\n\n    list_port_usados = del_copy(list_port_usados)\n    for i in list_port_usados:\n        list_all_port.remove(i)\n\n    db_machine= db1(db1.port_machine.id.belongs(list_all_port))\n    campos = [db1.port_machine.id, db1.port_machine.ip_machine, db1.port_machine.number_port, db1.port_machine.hostname]\n\n    gs = SQLFORM.grid(db_machine, fields = campos,\n                          csv=False, editable=False, deletable=False, searchable=False,\n                          details=False,create=False, user_signature=False,\n                          links=[lambda row:A(T("Select"),_href=URL(\'regis_student\', args=(semes, machine.id, course.id, num_group, row.id)))],\n                          links_placement = \'left\'#,\n                          #selectable = lambda ids:redirect(URL(\'maquinas\', \'configurar\', vars=dict(ids=ids)))\n    )\n\n    return locals()\n\n\n@auth.requires_login()\ndef regis_student():\n    semes = request.args(0)\n    course = db1.course(request.args(2, cast=int))\n    machine = db1.machine(request.args(1, cast=int) or redirect(URL(\'default\',\'index\')))\n    num_group = request.args(3) or redirect(URL(\'default\',\'index\'))\n    id_port_mach = db1.port_machine(request.args(4) or redirect(URL(\'default\',\'index\')))\n    db1.student_x_machine.ip_machine.default = id_port_mach.id\n    db1.student_x_machine.ip_machine.writable = False\n    db1.student_x_machine.ip_machine.reable = False\n    db1.student_x_machine.semester.default = semes\n    db1.student_x_machine.semester.writable = False\n    db1.student_x_machine.semester.reable = False\n    db1.student_x_machine.course_group.default = num_group\n    db1.student_x_machine.course_group.writable = False\n    db1.student_x_machine.course_group.reable = False\n    form = SQLFORM(db1.student_x_machine).process()\n    if form.accepted:\n        response.flash = T("Student Register")\n        redirect(URL(\'default\',\'index\'))\n    elif form.errors:\n        response.flash = \'form has errors\'\n    else:\n        response.flash = \'please fill the form\'\n    return locals()\n\n\n@auth.requires_login()\n@auth.requires_membership(\'Administrador\')\ndef agree_teacher():\n    rows = db1(db1.auth_user.registration_key==\'pending\').select()\n    return locals()\n\n@auth.requires_login()\ndef show_teacher():\n    user = db1.auth_user(request.args(0, cast=int))\n    user.update(registration_key=\'\')\n    db1.auth_user.first_name.writable = False\n    db1.auth_user.first_name.reable = False\n    db1.auth_user.last_name.writable = False\n    db1.auth_user.last_name.reable = False\n    form = SQLFORM(db1.auth_user, user, deletable=True, showid=False)\n\n    if form.process(next=URL(\'update_group_teacher\', args=user.id)).accepted:\n        response.flash = T (\'Teacher accepted\')\n    elif form.errors:\n        response.flash = T (\'Teacher No Update\')\n\n\n\n    return locals()\n\n@auth.requires_login()\ndef update_group_teacher():\n    member = db1.auth_membership(request.args(0, cast=int) or redirect(URL(\'index\')))\n\n    if member:\n        ruta_basica = os.path.join(request.folder, \'uploads/\')\n        ruta_basica = ruta_basica + str(member.user_id)\n        try:\n            os.makedirs(ruta_basica)\n        except OSError:\n            pass\n        # si no podemos crear la ruta dejamos que pase\n        # si la operaci\xc3\xb3n resulto con \xc3\xa9xito nos cambiamos al directorio\n        os.chdir(ruta_basica)\n        member.update(group_id=2)\n        db1.auth_membership.user_id.writable = False\n        db1.auth_membership.user_id.reable = False\n        db1.auth_membership.group_id.writable = False\n        db1.auth_membership.group_id.reable = False\n        form = SQLFORM(db1.auth_membership, member, showid=False)\n\n\n        if form.process(next=URL(\'agree_teacher\')).accepted:\n            response.flash = T (\'User Agree to Teacher Group\')\n        elif form.errors:\n            response.flash = T (\'Group No Update\')\n    else:\n        redirect(URL(\'default\',\'index\'))\n    return locals()\n\n@auth.requires_login()\ndef mostrar_macxuser():\n    course = db1.course(request.args(1, cast=int) or redirect(URL(\'index\')))\n    machine = db1.machine(request.args(0, cast=int) or redirect(URL(\'index\')))\n    #c_group = db1((db1.course_group.cod_course==course.id)& (db1.course_group.id_teacher==auth.user_id)).select()\n\n    groups_text = T("Groups of ")\n    query_grupos = ((db1.course_group.cod_course==course.id)& (db1.course_group.id_teacher==auth.user_id)) # eliminar la segunda condicion para q muestre todos los grupos de la materia\n    campos_grupo = [db1.course_group.cod_group, db1.course_group.semester]\n    groups = SQLFORM.grid(query_grupos, fields = campos_grupo,\n                          csv=False, editable=False, deletable=False, searchable=False,\n                          details=False,create=False, user_signature=False,\n                          links=[lambda row:A(T("Select"),_href=URL(\'show_ports\', args=(row.semester, machine.id, course.id, row.cod_group)))],\n                          links_placement = \'left\'\n    )\n    return locals()\n\n@auth.requires_login()\n@auth.requires_membership(\'Docente\')\ndef show_couxuser():\n    course = db1.course(request.args(0, cast=int) or redirect(URL(\'default\',\'index\')))\n    #c_machine= db1((db1.machine.code_course==course.id)).select()\n\n\n    query_maquinas = db1.machine.code_course==course.id\n    campos_maquina = [db1.machine.ip_machine, db1.machine.operative_system, db1.machine.memory, db1.machine.processor]\n    maquinas = SQLFORM.grid(query_maquinas, fields = campos_maquina, csv=False, editable=False, deletable=False,\n        searchable=False, # No no moverlo, la busqueda no va a servir debido a q user_signature esta desativado\n        details=False, create=False,\n        user_signature=False # Si se deja activada como es por defecto resulta en un error extrano, solo en este formulario\n        ,links=[lambda row:A(T("Select"),_href=URL(\'mostrar_macxuser\',args=(row.id, course.id)))],\n        links_placement = \'left\'\n    )\n\n    #groups_text = T("Groups of ")\n    #query_grupos = db1.course_group.cod_course==course.id and db1.course_group.id_teacher == auth.user_id # eliminar la segunda condicion para q muestre todos los grupos de la materia\n    #campos_grupo = [db1.course_group.cod_group, db1.course_group.semester]\n    #groups = SQLFORM.grid(query_grupos, fields = campos_grupo ,\n     #   csv=False, editable=False, deletable=False, searchable=False, details=False,\n      #  create=False, user_signature=False\n    #)\n    return locals()\n\n@auth.requires_login()\ndef show_ports():\n    semes = request.args(0)\n    course = db1.course(request.args(2, cast=int) or redirect(URL(\'default\',\'index\')))\n    machine = db1.machine(request.args(1, cast=int) or redirect(URL(\'default\',\'index\')))\n    num_group = request.args(3) or redirect(URL(\'default\',\'index\'))\n    port_mac = db1(db1.port_machine.ip_machine==machine.id).select()\n    response.flash = num_group\n    list_port = []\n\n    for port_m in port_mac:\n        list_est = db1((db1.student_x_machine.ip_machine==port_m.id) &\n                       (db1.student_x_machine.semester==semes) & (db1.student_x_machine.course_group==num_group)).select( db1.student_x_machine.name_student, db1.student_x_machine.code_student, db1.student_x_machine.course_group)\n        for l_est in list_est:\n            list_port.append((port_m.number_port, port_m.hostname, l_est.code_student, l_est.name_student, l_est.course_group))\n    if not list_port:\n        response.flash = T ("Currently there are no students")\n\n    return locals()\n\n\n@auth.requires_login()\ndef list_files():\n    folder_user = "uploads/" + str(auth.user_id) + "/"\n    ruta_basica = os.path.join(request.folder, folder_user)\n    lstDir = os.walk(ruta_basica)\n    #Lista vacia para incluir los ficheros\n    lstFiles = []\n    #Crea una lista de los ficheros jpg que existen en el directorio y los incluye a la lista.\n    for root, dirs, files in lstDir:\n        for fichero in files:\n            (nombreFichero, extension) = os.path.splitext(fichero)\n            lstFiles.append(nombreFichero+extension)\n\n    #res = response.stream(open(pathfilename,\'rb\'), chunk_size=10**6)\n\n    return locals()\n\n@auth.requires_login()\n## Reference http://www.web2py.com/AlterEgo/default/show/36\ndef my_big_file_downloader():\n    import os\n    filename=request.args[0]\n    folder_user = str(auth.user_id)\n    pathfilename= os.path.join(request.folder,\'uploads/\'+folder_user, filename)\n    return response.stream(open(pathfilename,\'rb\'), chunk_size=10**6)\n\n    # the old way\n# reference http://www.web2py.com/AlterEgo/default/show/36\n@auth.requires_login()\ndef my_small_file_downloader():\n    import os\n    import gluon.contenttype\n    filename=request.args[0]\n    folder_user = str(auth.user_id)\n    response.headers[\'Content-Type\']=gluon.contenttype.contenttype(filename)\n    pathfilename=os.path.join(request.folder,\'uploads/\'+folder_user, filename)\n    return open(\'pathfilename\', \'rb\').read()\n\n#def register_student():\n#    form = SQLFORM(db1.student_x_machine).process()\n#    if form.accepted:\n#        session.flash = T("Student Register")\n#        #redirect(URL(\'index\'))\n#    return locals()\n\nresponse._vars=response._caller(update_group_teacher)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "/home/camilo/Escritorio/nuevo_nuevo_repo_git/proyecto_mv/gluon/restricted.py", line 227, in restricted\n    exec ccode in environment\n  File "/home/camilo/Escritorio/nuevo_nuevo_repo_git/proyecto_mv/applications/datos/controllers/academia.py", line 299, in <module>\n  File "/home/camilo/Escritorio/nuevo_nuevo_repo_git/proyecto_mv/gluon/globals.py", line 415, in <lambda>\n    self._caller = lambda f: f()\n  File "/home/camilo/Escritorio/nuevo_nuevo_repo_git/proyecto_mv/gluon/tools.py", line 4231, in f\n    return action(*a, **b)\n  File "/home/camilo/Escritorio/nuevo_nuevo_repo_git/proyecto_mv/applications/datos/controllers/academia.py", line 182, in update_group_teacher\n    if form.process(next=URL(\'agree_teacher\')).accepted:\n  File "/home/camilo/Escritorio/nuevo_nuevo_repo_git/proyecto_mv/gluon/html.py", line 2306, in process\n    self.validate(**kwargs)\n  File "/home/camilo/Escritorio/nuevo_nuevo_repo_git/proyecto_mv/gluon/html.py", line 2243, in validate\n    if self.accepts(**kwargs):\n  File "/home/camilo/Escritorio/nuevo_nuevo_repo_git/proyecto_mv/gluon/sqlhtml.py", line 1742, in accepts\n    self.id_field_name]).update(**fields)\n  File "/home/camilo/Escritorio/nuevo_nuevo_repo_git/proyecto_mv/gluon/packages/dal/pydal/objects.py", line 2054, in update\n    ret = db._adapter.update("%s" % table._tablename, self.query, fields)\n  File "/home/camilo/Escritorio/nuevo_nuevo_repo_git/proyecto_mv/gluon/packages/dal/pydal/adapters/base.py", line 1031, in update\n    raise e\nIntegrityError: insert or update on table "auth_membership" violates foreign key constraint "auth_membership_group_id_fkey"\nDETAIL:  Key (group_id)=(2) is not present in table "auth_group".\n\n'
p11
s.